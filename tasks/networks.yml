# Standards: 0.1
---
- name: Define network spec
  loop: '{{ libvirt_networks }}'
  loop_control:
    label: '{{ item.name }}'
  when: item.state | default("active") != "destroyed"
  virt_net:
    command: define
    xml: '{{ lookup("template", "networks/spec.j2") }}'
  tags:
    - libvirt
    - networks

- name: Destroy network
  loop: '{{ libvirt_networks }}'
  loop_control:
    label: '{{ item.name }}'
  when: item.state | default("active") == 'absent'
  virt_net:
    name: '{{ item.name }}'
    command: destroy
  tags:
    - libvirt
    - networks

- name: Undefine networks
  loop: '{{ libvirt_networks }}'
  loop_control:
    label: '{{ item.name }}'
  when: item.state | default("active") == 'absent'
  virt_net:
    name: '{{ item.name }}'
    command: destroy
  tags:
    - libvirt
    - networks

- name: Autostart network
  loop: '{{ libvirt_networks }}'
  loop_control:
    label: '{{ item.name }}'
  when: item.state | default("active") == 'active'
  virt_net:
    name: '{{ item.name }}'
    autostart: '{{ item.autostart | default(True) }}'
  tags:
    - libvirt
    - networks

- name: Change network state
  loop: '{{ libvirt_networks }}'
  loop_control:
    label: '{{ item.name }}'
  when: item.state | default("active") == 'active'
  virt_net:
    name: '{{ item.name }}'
    state: '{{ item.state | default("active") }}'
  tags:
    - libvirt
    - networks

...
